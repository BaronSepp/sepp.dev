# yaml-language-server: $schema=https://raw.githubusercontent.com/compose-spec/compose-spec/master/schema/compose-spec.json
x-common-database: &database
  MONGO_AUTHSOURCE: admin
  MONGO_DBNAME: unifi
  MONGO_PASS: ${UNIFI_PASS}
  MONGO_USER: unifi

x-common-networks: &networks
  unifi:

services:
  unifi:
    extends:
      file: ../services/unifi-network-application.yaml
      service: unifi
    depends_on:
      - unifi-db
    networks:
      <<: *networks
    environment:
      <<: *database
      MONGO_HOST: unifi-db
      MONGO_PORT: 27017
    volumes:
      - unifi-config:/config

  unifi-db:
    extends:
      file: ../services/mongo.yaml
      service: mongo
    container_name: unifi-db
    networks:
      <<: *networks
    environment:
      <<: *database
    volumes:
      - unifi-db:/data/db
      - unifi-configdb:/data/configdb
      - ./scripts/unifi-init-db.sh:/docker-entrypoint-initdb.d/init-mongo.sh:z

volumes:
  unifi-db:
  unifi-configdb:
  unifi-config:

networks:
  unifi:
    driver: bridge
    ipam:
      config:
        - subnet: 172.16.0.32/28